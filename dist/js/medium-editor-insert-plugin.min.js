/*! 
 * medium-editor-insert-plugin v2.6.8 - jQuery insert plugin for MediumEditor
 *
 * http://linkesch.com/medium-editor-insert-plugin
 * 
 * Copyright (c) 2014 Pavel Linkesch (http://linkesch.com)
 * Released under the MIT license
 */


!function(t){"function"==typeof define&&define.amd?define(["jquery","handlebars","medium-editor","blueimp-file-upload"],t):"object"==typeof module&&module.exports?module.exports=function(e){if("undefined"==typeof window)throw new Error("medium-editor-insert-plugin runs only in a browser.");return void 0===e&&(e=require("jquery")),window.jQuery=e,Handlebars=require("handlebars"),MediumEditor=require("medium-editor"),require("blueimp-file-upload"),t(0,Handlebars,MediumEditor),e}:t(jQuery,Handlebars,MediumEditor)}(function(e,t,u){this.MediumInsert=this.MediumInsert||{},this.MediumInsert.Templates=this.MediumInsert.Templates||{},this.MediumInsert.Templates["src/js/templates/core-buttons.hbs"]=t.template({1:function(e,t,i,o,s){var n=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,a="function",l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <li><button data-addon="'+e.escapeExpression(typeof(e=null!=(e=l(i,"key")||s&&l(s,"key"))?e:r)==a?e.call(n,{name:"key",hash:{},data:s,loc:{start:{line:5,column:36},end:{line:5,column:44}}}):e)+'" data-action="add" class="medium-insert-action" type="button">'+(null!=(e=typeof(e=null!=(e=l(i,"label")||(null!=t?l(t,"label"):t))?e:r)==a?e.call(n,{name:"label",hash:{},data:s,loc:{start:{line:5,column:107},end:{line:5,column:118}}}):e)?e:"")+"</button>\n            </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="medium-insert-buttons" contenteditable="false" style="display: none">\n    <button class="medium-insert-buttons-show" type="button"><span>+</span></button>\n    <ul class="medium-insert-buttons-addons" style="display: none">\n'+(null!=(s=n(i,"each").call(null!=t?t:e.nullContext||{},null!=t?n(t,"addons"):t,{name:"each",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s,loc:{start:{line:4,column:8},end:{line:7,column:17}}}))?s:"")+'        <input type="file" id="medium-insert-file-selector">\n    </ul>\n</div>\n'},useData:!0}),this.MediumInsert.Templates["src/js/templates/core-caption.hbs"]=t.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<p class="figcaption" contenteditable="true" class="medium-insert-caption-placeholder" data-placeholder="'+e.escapeExpression("function"==typeof(n=null!=(n=n(i,"placeholder")||(null!=t?n(t,"placeholder"):t))?n:e.hooks.helperMissing)?n.call(null!=t?t:e.nullContext||{},{name:"placeholder",hash:{},data:s,loc:{start:{line:1,column:105},end:{line:1,column:120}}}):n)+'"></figcaption>'},useData:!0}),this.MediumInsert.Templates["src/js/templates/core-empty-line.hbs"]=t.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){return"<p><br></p>\n"},useData:!0}),this.MediumInsert.Templates["src/js/templates/embeds-toolbar.hbs"]=t.template({1:function(e,t,i,o,s){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="medium-insert-embeds-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active">\n        <ul class="medium-editor-toolbar-actions clearfix">\n'+(null!=(s=n(i,"each").call(null!=t?t:e.nullContext||{},null!=t?n(t,"styles"):t,{name:"each",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s,loc:{start:{line:4,column:12},end:{line:10,column:21}}}))?s:"")+"        </ul>\n    </div>\n"},2:function(e,t,i,o,s){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(s=n(i,"if").call(null!=t?t:e.nullContext||{},null!=t?n(t,"label"):t,{name:"if",hash:{},fn:e.program(3,s,0),inverse:e.noop,data:s,loc:{start:{line:5,column:16},end:{line:9,column:23}}}))?s:""},3:function(e,t,i,o,s){var n=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,a="function",l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                    <li>\n                        <button class="medium-editor-action" data-action="'+e.escapeExpression(typeof(e=null!=(e=l(i,"key")||s&&l(s,"key"))?e:r)==a?e.call(n,{name:"key",hash:{},data:s,loc:{start:{line:7,column:74},end:{line:7,column:82}}}):e)+'">'+(null!=(e=typeof(e=null!=(e=l(i,"label")||(null!=t?l(t,"label"):t))?e:r)==a?e.call(n,{name:"label",hash:{},data:s,loc:{start:{line:7,column:84},end:{line:7,column:95}}}):e)?e:"")+"</button>\n                    </li>\n"},5:function(e,t,i,o,s){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="medium-insert-embeds-toolbar2 medium-editor-toolbar medium-editor-toolbar-active">\n        <ul class="medium-editor-toolbar-actions clearfix">\n'+(null!=(s=n(i,"each").call(null!=t?t:e.nullContext||{},null!=t?n(t,"actions"):t,{name:"each",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s,loc:{start:{line:18,column:12},end:{line:24,column:21}}}))?s:"")+"        </ul>\n    </div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n,r=null!=t?t:e.nullContext||{},a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(n=a(i,"if").call(r,null!=t?a(t,"styles"):t,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s,loc:{start:{line:1,column:0},end:{line:13,column:7}}}))?n:"")+"\n"+(null!=(n=a(i,"if").call(r,null!=t?a(t,"actions"):t,{name:"if",hash:{},fn:e.program(5,s,0),inverse:e.noop,data:s,loc:{start:{line:15,column:0},end:{line:27,column:7}}}))?n:"")},useData:!0}),this.MediumInsert.Templates["src/js/templates/embeds-wrapper.hbs"]=t.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="medium-insert-embeds" contenteditable="false">\n\t<figure>\n\t\t<div class="medium-insert-embed">\n\t\t\t'+(null!=(n="function"==typeof(n=null!=(n=n(i,"html")||(null!=t?n(t,"html"):t))?n:e.hooks.helperMissing)?n.call(null!=t?t:e.nullContext||{},{name:"html",hash:{},data:s,loc:{start:{line:4,column:3},end:{line:4,column:13}}}):n)?n:"")+'\n\t\t</div>\n\t</figure>\n\t<div class="medium-insert-embeds-overlay"></div>\n</div>'},useData:!0}),this.MediumInsert.Templates["src/js/templates/images-image.hbs"]=t.template({1:function(e,t,i,o,s){return'        <div class="medium-insert-images-progress"></div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n,r=null!=t?t:e.nullContext||{},a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<figure contenteditable="false">\n    <img src="'+e.escapeExpression("function"==typeof(n=null!=(n=a(i,"img")||(null!=t?a(t,"img"):t))?n:e.hooks.helperMissing)?n.call(r,{name:"img",hash:{},data:s,loc:{start:{line:2,column:14},end:{line:2,column:21}}}):n)+'" alt="" />\n'+(null!=(s=a(i,"if").call(r,null!=t?a(t,"progress"):t,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s,loc:{start:{line:3,column:4},end:{line:5,column:11}}}))?s:"")+"</figure>\n"},useData:!0}),this.MediumInsert.Templates["src/js/templates/images-progressbar.hbs"]=t.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){return'<progress min="0" max="100" value="0">0</progress>'},useData:!0}),this.MediumInsert.Templates["src/js/templates/images-toolbar.hbs"]=t.template({1:function(e,t,i,o,s){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(s=n(i,"if").call(null!=t?t:e.nullContext||{},null!=t?n(t,"label"):t,{name:"if",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s,loc:{start:{line:4,column:12},end:{line:8,column:19}}}))?s:""},2:function(e,t,i,o,s){var n=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,a="function",l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <li>\n                    <button class="medium-editor-action" data-action="'+e.escapeExpression(typeof(e=null!=(e=l(i,"key")||s&&l(s,"key"))?e:r)==a?e.call(n,{name:"key",hash:{},data:s,loc:{start:{line:6,column:70},end:{line:6,column:78}}}):e)+'">'+(null!=(e=typeof(e=null!=(e=l(i,"label")||(null!=t?l(t,"label"):t))?e:r)==a?e.call(n,{name:"label",hash:{},data:s,loc:{start:{line:6,column:80},end:{line:6,column:91}}}):e)?e:"")+"</button>\n                </li>\n"},4:function(e,t,i,o,s){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t<div class="medium-insert-images-toolbar2 medium-editor-toolbar medium-editor-toolbar-active">\n\t\t<ul class="medium-editor-toolbar-actions clearfix">\n'+(null!=(s=n(i,"each").call(null!=t?t:e.nullContext||{},null!=t?n(t,"actions"):t,{name:"each",hash:{},fn:e.program(5,s,0),inverse:e.noop,data:s,loc:{start:{line:16,column:9},end:{line:22,column:18}}}))?s:"")+"    \t</ul>\n    </div>\n"},5:function(e,t,i,o,s){var n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(s=n(i,"if").call(null!=t?t:e.nullContext||{},null!=t?n(t,"label"):t,{name:"if",hash:{},fn:e.program(6,s,0),inverse:e.noop,data:s,loc:{start:{line:17,column:13},end:{line:21,column:20}}}))?s:""},6:function(e,t,i,o,s){var n=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,a="function",l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        \t        <li>\n        \t            <button class="medium-editor-action" data-action="'+e.escapeExpression(typeof(e=null!=(e=l(i,"key")||s&&l(s,"key"))?e:r)==a?e.call(n,{name:"key",hash:{},data:s,loc:{start:{line:19,column:71},end:{line:19,column:79}}}):e)+'">'+(null!=(e=typeof(e=null!=(e=l(i,"label")||(null!=t?l(t,"label"):t))?e:r)==a?e.call(n,{name:"label",hash:{},data:s,loc:{start:{line:19,column:81},end:{line:19,column:92}}}):e)?e:"")+"</button>\n        \t        </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n,r=null!=t?t:e.nullContext||{},a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active">\n    <ul class="medium-editor-toolbar-actions clearfix">\n'+(null!=(n=a(i,"each").call(r,null!=t?a(t,"styles"):t,{name:"each",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s,loc:{start:{line:3,column:8},end:{line:9,column:17}}}))?n:"")+"    </ul>\n</div>\n\n"+(null!=(n=a(i,"if").call(r,null!=t?a(t,"actions"):t,{name:"if",hash:{},fn:e.program(4,s,0),inverse:e.noop,data:s,loc:{start:{line:13,column:0},end:{line:25,column:7}}}))?n:"")},useData:!0}),window.MediumInsert=this.MediumInsert,function(a,l,n,o){"use strict";var s="mediumInsert",r={editor:null,enabled:!0,addons:{images:!0,embeds:!0}};function d(e){return e.charAt(0).toUpperCase()+e.slice(1)}function m(e,t){var i;this.el=e,this.$el=a(e),this.templates=l.MediumInsert.Templates,t&&(i=t.editor,t.editor=null),this.options=a.extend(!0,{},r,t),this.options.editor=i,t&&(t.editor=i),this._defaults=r,this._name=s,this.options&&this.options.editor&&(this.options.editor._serialize===o&&(this.options.editor._serialize=this.options.editor.serialize),this.options.editor._destroy===o&&(this.options.editor._destroy=this.options.editor.destroy),this.options.editor._setup===o&&(this.options.editor._setup=this.options.editor.setup),this.options.editor._hideInsertButtons=this.hideButtons,this.options.editor.serialize=this.editorSerialize,this.options.editor.destroy=this.editorDestroy,this.options.editor.setup=this.editorSetup,this.options.editor.getExtensionByName("placeholder")!==o&&(this.options.editor.getExtensionByName("placeholder").updatePlaceholder=this.editorUpdatePlaceholder))}m.prototype.init=function(){this.$el.addClass("medium-editor-insert-plugin"),"object"==typeof this.options.addons&&0!==Object.keys(this.options.addons).length||this.disable(),this.initAddons(),this.clean(),this.events()},m.prototype.events=function(){var t=this;this.$el.on("dragover drop",function(e){e.preventDefault()}).on("keyup click",a.proxy(this,"toggleButtons")).on("selectstart mousedown",".medium-insert, .medium-insert-buttons",a.proxy(this,"disableSelection")).on("click",".medium-insert-buttons-show",a.proxy(this,"toggleAddons")).on("click",".medium-insert-action",a.proxy(this,"addonAction")).on("mousedown",".medium-insert-images img",function(){return!1}).on("paste",".medium-insert-caption-placeholder",function(e){a.proxy(t,"removeCaptionPlaceholder")(a(e.target))}),a(l).on("resize",a.proxy(this,"positionButtons",null))},m.prototype.getEditor=function(){return this.options.editor},m.prototype.editorSerialize=function(){var i=this._serialize();return a.each(i,function(e){var t=a("<div />").html(i[e].value);t.find(".medium-insert-buttons").remove(),t.find(".medium-insert-active").removeClass("medium-insert-active"),t.find("[data-embed-code]").each(function(){var e=a(this),t=a("<div />").html(e.attr("data-embed-code")).text();e.html(t)}),i[e].value=t.html()}),i},m.prototype.editorDestroy=function(){a.each(this.elements,function(e,t){a(t).data("plugin_"+s)instanceof m&&a(t).data("plugin_"+s).disable()}),this._destroy()},m.prototype.editorSetup=function(){this._setup(),a.each(this.elements,function(e,t){a(t).data("plugin_"+s)instanceof m&&a(t).data("plugin_"+s).enable()})},m.prototype.editorUpdatePlaceholder=function(e,t){var i=a(e).children().not(".medium-insert-buttons").contents();t||1!==i.length||"br"!==i[0].nodeName.toLowerCase()?this.hidePlaceholder(e):(this.showPlaceholder(e),this.base._hideInsertButtons(a(e)))},m.prototype.triggerInput=function(){this.getEditor()&&this.getEditor().trigger("editableInput",null,this.el)},m.prototype.deselect=function(){n.getSelection().removeAllRanges()},m.prototype.disable=function(){this.options.enabled=!1,this.$el.find(".medium-insert-buttons").addClass("hide")},m.prototype.enable=function(){this.options.enabled=!0,this.$el.find(".medium-insert-buttons").removeClass("hide")},m.prototype.disableSelection=function(e){var t=a(e.target);!1!==t.is("img")&&!t.hasClass("medium-insert-buttons-show")||e.preventDefault()},m.prototype.initAddons=function(){var o=this;this.options.addons&&0!==this.options.addons.length&&a.each(this.options.addons,function(e,t){var i=s+d(e);!1!==t?(o.$el[i](t),o.options.addons[e]=o.$el.data("plugin_"+i).options):delete o.options.addons[e]})},m.prototype.clean=function(){var e,t,i=this;!1!==this.options.enabled&&(0===this.$el.html().length&&this.$el.html(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),this.$el.contents().filter(function(){return"#text"===this.nodeName&&""!==a.trim(a(this).text())||"br"===this.nodeName.toLowerCase()}).each(function(){a(this).wrap("<p />"),i.moveCaret(a(this).parent(),a(this).text().length)}),this.addButtons(),(t=(e=this.$el.find(".medium-insert-buttons")).prev()).attr("class")&&t.attr("class").match(/medium\-insert(?!\-active)/)&&e.before(this.templates["src/js/templates/core-empty-line.hbs"]().trim()))},m.prototype.getButtons=function(){if(!1!==this.options.enabled)return this.templates["src/js/templates/core-buttons.hbs"]({addons:this.options.addons}).trim()},m.prototype.addButtons=function(){0===this.$el.find(".medium-insert-buttons").length&&this.$el.append(this.getButtons())},m.prototype.toggleButtons=function(e){var t,i,o,s=a(e.target),e=l.getSelection(),n=this;!1!==this.options.enabled&&((t=e&&0!==e.rangeCount?(e=e.getRangeAt(0),a(e.commonAncestorContainer)):s).hasClass("medium-editor-insert-plugin")&&(t=t.find("p:first")),i=t.is("p")?t:t.closest("p"),this.clean(),!1===s.hasClass("medium-editor-placeholder")&&0===s.closest(".medium-insert-buttons").length&&0===t.closest(".medium-insert-buttons").length&&(this.$el.find(".medium-insert-active").removeClass("medium-insert-active"),a.each(this.options.addons,function(e){(t=s.closest(".medium-insert-"+e).length?s:t).closest(".medium-insert-"+e).length&&(i=t.closest(".medium-insert-"+e),o=e)}),i.length&&(""===i.text().trim()&&!o||"images"===o)?(i.addClass("medium-insert-active"),"images"===o?this.$el.find(".medium-insert-buttons").attr("data-active-addon",o):this.$el.find(".medium-insert-buttons").removeAttr("data-active-addon"),setTimeout(function(){o||(n.positionButtons(o),n.showButtons(o))},o?100:0)):this.hideButtons()))},m.prototype.showButtons=function(e){var t=this.$el.find(".medium-insert-buttons");t.show(),t.find("li").show(),e&&(t.find("li").hide(),t.find('button[data-addon="'+e+'"]').parent().show())},m.prototype.hideButtons=function(e){(e=e||this.$el).find(".medium-insert-buttons").hide(),e.find(".medium-insert-buttons-addons").hide(),e.find(".medium-insert-buttons-show").removeClass("medium-insert-buttons-rotate")},m.prototype.positionButtons=function(e){var t=this.$el.find(".medium-insert-buttons"),i=this.$el.find(".medium-insert-active"),o=i.hasClass("medium-insert-images-grid")?[]:i.find("figure:last p.figcaption"),s=this.getEditor()?this.getEditor().options.elementsContainer:a("body").get(0),n=-1<["absolute","fixed"].indexOf(l.getComputedStyle(s).getPropertyValue("position")),r={};i.length&&(r.left=i.position().left,r.top=i.position().top,e?(r.left+=i.width()-t.find(".medium-insert-buttons-show").width()-10,r.top+=i.height()-20+(o.length?-o.height()-parseInt(o.css("margin-top"),10):10)):(r.left+=-parseInt(t.find(".medium-insert-buttons-addons").css("left"),10)-parseInt(t.find(".medium-insert-buttons-addons button:first").css("margin-left"),10),r.top+=parseInt(i.css("margin-top"),10)),n&&(r.top+=s.scrollTop),!1===this.$el.hasClass("medium-editor-placeholder")&&r.left<0&&(r.left=i.position().left),t.css(r))},m.prototype.toggleAddons=function(){"images"!==this.$el.find(".medium-insert-buttons").attr("data-active-addon")?(this.$el.find(".medium-insert-buttons-addons").fadeToggle(),this.$el.find(".medium-insert-buttons-show").toggleClass("medium-insert-buttons-rotate")):this.$el.find(".medium-insert-buttons").find('button[data-addon="images"]').click()},m.prototype.hideAddons=function(){this.$el.find(".medium-insert-buttons-addons").hide(),this.$el.find(".medium-insert-buttons-show").removeClass("medium-insert-buttons-rotate")},m.prototype.addonAction=function(e){var t=a(e.currentTarget),e=t.data("addon"),t=t.data("action");this.$el.data("plugin_"+s+d(e))[t]()},m.prototype.moveCaret=function(e,t){var i,o,s;t=t||0,i=n.createRange(),o=l.getSelection(),(s=e.get(0)).childNodes.length||(e=n.createTextNode(" "),s.appendChild(e)),i.setStart(s.childNodes[0],t),i.collapse(!0),o.removeAllRanges(),o.addRange(i)},m.prototype.addCaption=function(e,t){0===e.find("p.figcaption").length&&e.append(this.templates["src/js/templates/core-caption.hbs"]({placeholder:t}))},m.prototype.removeCaptions=function(e){var t=this.$el.find("p.figcaption");(t=e?t.not(e):t).each(function(){!a(this).hasClass("medium-insert-caption-placeholder")&&""!==a(this).text().trim()||a(this).remove()})},m.prototype.removeCaptionPlaceholder=function(e){e=e.is("p.figcaption")?e:e.find("p.figcaption");e.length&&e.removeClass("medium-insert-caption-placeholder").removeAttr("data-placeholder")},a.fn[s]=function(i){return this.each(function(){var e,t=this;a(t).is("textarea")&&(e=a(t).attr("medium-editor-textarea-id"),t=a(t).siblings('[medium-editor-textarea-id="'+e+'"]').get(0)),a.data(t,"plugin_"+s)?"string"==typeof i&&a.data(t,"plugin_"+s)[i]&&a.data(t,"plugin_"+s)[i]():(a.data(t,"plugin_"+s,new m(t,i)),a.data(t,"plugin_"+s).init())})}}(jQuery,window,document),function(l,d,a){"use strict";var i="mediumInsert",t="Embeds",o={label:'<span class="fa fa-youtube-play"></span>',placeholder:"Paste a YouTube, Vimeo, Facebook, Twitter or Instagram link and press Enter",oembedProxy:"http://medium.iframe.ly/api/oembed?iframe=1",captions:!0,captionPlaceholder:"Type caption (optional)",storeMeta:!1,styles:{wide:{label:'<span class="fa fa-align-justify"></span>'},left:{label:'<span class="fa fa-align-left"></span>'},right:{label:'<span class="fa fa-align-right"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(){var e=l.Event("keydown");e.which=8,l(a).trigger(e)}}},parseOnPaste:!1};function s(e,t){this.el=e,this.$el=l(e),this.templates=d.MediumInsert.Templates,this.core=this.$el.data("plugin_"+i),this.options=l.extend(!0,{},o,t),this._defaults=o,this._name=i,this.core.getEditor()&&(this.core.getEditor()._serializePreEmbeds=this.core.getEditor().serialize,this.core.getEditor().serialize=this.editorSerialize),this.init()}s.prototype.init=function(){var e=this.$el.find(".medium-insert-embeds");e.attr("contenteditable",!1),e.each(function(){0===l(this).find(".medium-insert-embeds-overlay").length&&l(this).append(l("<div />").addClass("medium-insert-embeds-overlay"))}),this.events(),this.backwardsCompatibility()},s.prototype.events=function(){l(a).on("click",l.proxy(this,"unselectEmbed")).on("keydown",l.proxy(this,"removeEmbed")).on("click",".medium-insert-embeds-toolbar .medium-editor-action",l.proxy(this,"toolbarAction")).on("click",".medium-insert-embeds-toolbar2 .medium-editor-action",l.proxy(this,"toolbar2Action")),this.$el.on("keyup click paste",l.proxy(this,"togglePlaceholder")).on("keydown",l.proxy(this,"processLink")).on("click",".medium-insert-embeds-overlay",l.proxy(this,"selectEmbed")).on("contextmenu",".medium-insert-embeds-placeholder",l.proxy(this,"fixRightClickOnPlaceholder")),this.options.parseOnPaste&&this.$el.on("paste",l.proxy(this,"processPasted")),l(d).on("resize",l.proxy(this,"autoRepositionToolbars"))},s.prototype.backwardsCompatibility=function(){var e=this;this.$el.find(".mediumInsert-embeds").removeClass("mediumInsert-embeds").addClass("medium-insert-embeds"),this.$el.find(".medium-insert-embeds").each(function(){0===l(this).find(".medium-insert-embed").length&&(l(this).after(e.templates["src/js/templates/embeds-wrapper.hbs"]({html:l(this).html()})),l(this).remove())})},s.prototype.editorSerialize=function(){var o=this._serializePreEmbeds();return l.each(o,function(e){var t=l("<div />").html(o[e].value),i=t.find(".medium-insert-embeds");i.removeAttr("contenteditable"),i.find("p.figcaption").removeAttr("contenteditable"),t.find(".medium-insert-embeds-overlay").remove(),o[e].value=t.html()}),o},s.prototype.add=function(){var e=this.$el.find(".medium-insert-active");e.html(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),e.is("p")&&(e.replaceWith('<div class="medium-insert-active">'+e.html()+"</div>"),e=this.$el.find(".medium-insert-active"),this.core.moveCaret(e)),e.addClass("medium-insert-embeds medium-insert-embeds-input medium-insert-embeds-active"),this.togglePlaceholder({target:e.get(0)}),e.click(),this.core.hideButtons()},s.prototype.togglePlaceholder=function(e){var t=l(e.target),e=d.getSelection();e&&0!==e.rangeCount&&(e=e.getRangeAt(0),(e=l(e.commonAncestorContainer)).hasClass("medium-insert-embeds-active")?t=e:e.closest(".medium-insert-embeds-active").length&&(t=e.closest(".medium-insert-embeds-active")),t.hasClass("medium-insert-embeds-active")?""===(e=t.text().trim())&&!1===t.hasClass("medium-insert-embeds-placeholder")?t.addClass("medium-insert-embeds-placeholder").attr("data-placeholder",this.options.placeholder):""!==e&&t.hasClass("medium-insert-embeds-placeholder")&&t.removeClass("medium-insert-embeds-placeholder").removeAttr("data-placeholder"):this.$el.find(".medium-insert-embeds-active").remove())},s.prototype.fixRightClickOnPlaceholder=function(e){this.core.moveCaret(l(e.target))},s.prototype.processLink=function(e){var t,i=this.$el.find(".medium-insert-embeds-active");i.length&&(""!==(t=i.text().trim())||-1===[8,46,13].indexOf(e.which)?13===e.which&&(e.preventDefault(),e.stopPropagation(),this.options.oembedProxy?this.oembed(t):this.parseUrl(t)):i.remove())},s.prototype.processPasted=function(e){l(".medium-insert-embeds-active").length||(e=e.originalEvent.clipboardData.getData("text"),new RegExp("^(http(s?):)?//","i").test(e)&&(this.options.oembedProxy?this.oembed(e,!0):this.parseUrl(e,!0)))},s.prototype.oembed=function(s,i){var n=this;l.support.cors=!0,l.ajax({crossDomain:!0,cache:!1,url:this.options.oembedProxy,dataType:"json",data:{url:s},success:function(e){var t=e&&e.html;n.options.storeMeta&&(t+='<div class="medium-insert-embeds-meta"><script type="text/json">'+JSON.stringify(e)+"<\/script></div>"),((t=e&&!t&&"photo"===e.type&&e.url?'<img src="'+e.url+'" alt="">':t)?i?l.proxy(n,"embed",t,s):l.proxy(n,"embed",t):l.proxy(n,"convertBadEmbed",s))()},error:function(e,t,i){var o=function(){try{return JSON.parse(e.responseText)}catch(e){}}();void 0!==d.console?d.console.log(o&&o.error||e.status||i.message):d.alert("Error requesting media from "+n.options.oembedProxy+" to insert: "+i+" (response status: "+e.status+")"),l.proxy(n,"convertBadEmbed",s)()}})},s.prototype.parseUrl=function(e,t){var i;return new RegExp(["youtube","youtu.be","vimeo","instagram","twitter","facebook"].join("|")).test(e)?(i=e.replace(/\n?/g,"").replace(/^((http(s)?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/(watch\?v=|v\/)?)([a-zA-Z0-9\-_]+)(.*)?$/,'<div class="video video-youtube"><iframe width="420" height="315" src="//www.youtube.com/embed/$7" frameborder="0" allowfullscreen></iframe></div>').replace(/^https?:\/\/vimeo\.com(\/.+)?\/([0-9]+)$/,'<div class="video video-vimeo"><iframe src="//player.vimeo.com/video/$2" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>').replace(/^https:\/\/twitter\.com\/(\w+)\/status\/(\d+)\/?$/,'<blockquote class="twitter-tweet" align="center" lang="en"><a href="https://twitter.com/$1/statuses/$2"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"><\/script>').replace(/^(https:\/\/www\.facebook\.com\/(.*))$/,'<script src="//connect.facebook.net/en_US/sdk.js#xfbml=1&amp;version=v2.2" async><\/script><div class="fb-post" data-href="$1"><div class="fb-xfbml-parse-ignore"><a href="$1">Loading Facebook post...</a></div></div>').replace(/^https?:\/\/instagram\.com\/p\/(.+)\/?$/,'<span class="instagram"><iframe src="//instagram.com/p/$1/embed/" width="612" height="710" frameborder="0" scrolling="no" allowtransparency="true"></iframe></span>'),this.options.storeMeta&&(i+='<div class="medium-insert-embeds-meta"><script type="text/json">'+JSON.stringify({})+"<\/script></div>"),!1===/<("[^"]*"|'[^']*'|[^'">])*>/.test(i)?(l.proxy(this,"convertBadEmbed",e)(),!1):void(t?this.embed(i,e):this.embed(i))):(l.proxy(this,"convertBadEmbed",e)(),!1)},s.prototype.embed=function(e,t){var i,o=this.$el.find(".medium-insert-embeds-active");if(!e)return alert("Incorrect URL format specified"),!1;-1<e.indexOf("<\/script>")&&(i=l("<div>").attr("data-embed-code",l("<div />").text(e).html()).html(e),e=l("<div>").append(i).html()),t?((o=this.$el.find(":not(iframe, script, style)").contents().filter(function(){return 3===this.nodeType&&-1<this.textContent.indexOf(t)}).parent()).after(this.templates["src/js/templates/embeds-wrapper.hbs"]({html:e})),o.text(o.text().replace(t,"")),o.after(this.templates["src/js/templates/core-empty-line.hbs"]().trim())):(o.after(this.templates["src/js/templates/embeds-wrapper.hbs"]({html:e})),o.remove()),this.core.triggerInput(),-1!==e.indexOf("facebook")&&"undefined"!=typeof FB&&setTimeout(function(){FB.XFBML.parse()},2e3)},s.prototype.convertBadEmbed=function(e){var t=this.templates["src/js/templates/core-empty-line.hbs"]().trim(),i=this.$el.find(".medium-insert-embeds-active"),o=l(t);i.before(o),i.remove(),o.html(e),t=l(t),o.after(t),this.core.triggerInput(),this.core.moveCaret(t)},s.prototype.selectEmbed=function(e){var t,i=this;this.core.options.enabled&&((t=l(e.target).hasClass("medium-insert-embeds")?l(e.target):l(e.target).closest(".medium-insert-embeds")).addClass("medium-insert-embeds-selected"),setTimeout(function(){i.addToolbar(),i.options.captions&&i.core.addCaption(t.find("figure"),i.options.captionPlaceholder)},50))},s.prototype.unselectEmbed=function(e){var t=l(e.target).hasClass("medium-insert-embeds")?l(e.target):l(e.target).closest(".medium-insert-embeds"),i=this.$el.find(".medium-insert-embeds-selected");if(t.hasClass("medium-insert-embeds-selected"))return i.not(t).removeClass("medium-insert-embeds-selected"),l(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),this.core.removeCaptions(t.find("p.figcaption")),void((l(e.target).is(".medium-insert-caption-placeholder")||l(e.target).is("p.figcaption"))&&(t.removeClass("medium-insert-embeds-selected"),this.core.removeCaptionPlaceholder(t.find("figure"))));i.removeClass("medium-insert-embeds-selected"),l(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),l(e.target).is(".medium-insert-caption-placeholder")?this.core.removeCaptionPlaceholder(t.find("figure")):!1===l(e.target).is("p.figcaption")&&this.core.removeCaptions()},s.prototype.removeEmbed=function(e){var t,i,o,s,n=[],r=this.$el.find(".medium-insert-embeds-selected");if(8!==e.which&&46!==e.which||(r.length&&n.push(r),(i=d.getSelection())&&i.rangeCount&&(i="#text"===(r=i.getRangeAt(0).commonAncestorContainer).nodeName||"BR"===r.nodeName?l(r).parent():l(r),r=u.selection.getCaretOffsets(r).left,8===e.which&&0===r?o=i.prev():46===e.which&&r===i.text().length&&(o=i.next()),o&&o.hasClass("medium-insert-embeds")&&n.push(o),(o=u.selection.getSelectionHtml(a))&&l("<div></div>").html(o).find(".medium-insert-embeds").each(function(){n.push(l(this))}))),n.length){for(s=0;s<n.length;s++)e.preventDefault(),l(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),t=l(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),n[s].before(t),n[s].remove(),this.core.hideAddons(),this.core.moveCaret(t),this.core.triggerInput();this.core.hideAddons(),!o&&t&&(e.preventDefault(),this.core.moveCaret(t)),l(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),this.core.triggerInput()}},s.prototype.addToolbar=function(){var e,t,i,o;this.options.toolbar&&(e=this.$el.find(".medium-insert-embeds-selected"),t=!1,0!==e.length&&(o=this.core.getEditor().options.elementsContainer||"body",l(o).append(this.templates["src/js/templates/embeds-toolbar.hbs"]({styles:this.options.styles,actions:this.options.actions}).trim()),i=l(".medium-insert-embeds-toolbar"),o=l(".medium-insert-embeds-toolbar2"),i.find("button").each(function(){e.hasClass("medium-insert-embeds-"+l(this).data("action"))&&(l(this).addClass("medium-editor-button-active"),t=!0)}),!1===t&&i.find("button").first().addClass("medium-editor-button-active"),this.repositionToolbars(),i.fadeIn(),o.fadeIn()))},s.prototype.autoRepositionToolbars=function(){setTimeout(function(){this.repositionToolbars(),this.repositionToolbars()}.bind(this),0)},s.prototype.repositionToolbars=function(){var e=l(".medium-insert-embeds-toolbar"),t=l(".medium-insert-embeds-toolbar2"),i=this.$el.find(".medium-insert-embeds-selected"),o=this.core.getEditor().options.elementsContainer,s=-1<["absolute","fixed"].indexOf(d.getComputedStyle(o).getPropertyValue("position")),n=s?o.getBoundingClientRect():null,r=l(d).width(),a={};t.length&&(a.top=i.offset().top+2,a.left=i.offset().left+i.width()-t.width()-4,s&&(a.top+=o.scrollTop-n.top,a.left-=n.left,r=l(o).width()),a.left+t.width()>r&&(a.left=r-t.width()),t.css(a)),e.length&&(a.left=i.offset().left+i.width()/2-e.width()/2,a.top=i.offset().top-e.height()-8-2-5,s&&(a.top+=o.scrollTop-n.top,a.left-=n.left),a.top<0&&(a.top=0),e.css(a))},s.prototype.toolbarAction=function(e){var t=l(e.target).is("button")?l(e.target):l(e.target).closest("button"),i=t.closest("li"),e=i.closest("ul").find("li"),o=this.$el.find(".medium-insert-embeds-selected"),s=this;t.addClass("medium-editor-button-active"),i.siblings().find(".medium-editor-button-active").removeClass("medium-editor-button-active"),e.find("button").each(function(){var e="medium-insert-embeds-"+l(this).data("action");l(this).hasClass("medium-editor-button-active")?(o.addClass(e),(s.options.styles[l(this).data("action")]||{}).added&&s.options.styles[l(this).data("action")].added(o)):(o.removeClass(e),(s.options.styles[l(this).data("action")]||{}).removed&&s.options.styles[l(this).data("action")].removed(o))}),this.core.triggerInput()},s.prototype.toolbar2Action=function(e){e=l(e.target).is("button")?l(e.target):l(e.target).closest("button"),e=(this.options.actions[e.data("action")]||{}).clicked;e&&e(this.$el.find(".medium-insert-embeds-selected")),this.core.triggerInput()},l.fn[i+t]=function(e){return this.each(function(){l.data(this,"plugin_"+i+t)||l.data(this,"plugin_"+i+t,new s(this,e))})}}(jQuery,window,document),function(d,m,c){"use strict";var i="mediumInsert",t="Images",o={label:'<span class="fa fa-camera"></span>',deleteMethod:"POST",deleteScript:"delete.php",preview:!0,captions:!0,captionPlaceholder:"Type caption for image (optional)",autoGrid:3,fileUploadOptions:{url:null,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i},fileDeleteOptions:{},styles:{wide:{label:'<span class="fa fa-align-justify"></span>'},left:{label:'<span class="fa fa-align-left"></span>'},right:{label:'<span class="fa fa-align-right"></span>'},grid:{label:'<span class="fa fa-th"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(){var e=d.Event("keydown");e.which=8,d(c).trigger(e)}}},sorting:function(){},messages:{acceptFileTypesError:"This file is not in a supported format: ",maxFileSizeError:"This file is too big: "}};function s(e,t){this.el=e,this.$el=d(e),this.$currentImage=null,this.templates=m.MediumInsert.Templates,this.core=this.$el.data("plugin_"+i),this.options=d.extend(!0,{},o,t),this._defaults=o,this._name=i,this.options.preview&&!m.FileReader&&(this.options.preview=!1),this.core.getEditor()&&(this.core.getEditor()._serializePreImages=this.core.getEditor().serialize,this.core.getEditor().serialize=this.editorSerialize),this.init()}s.prototype.init=function(){var e=this.$el.find(".medium-insert-images");e.find("p.figcaption").attr("contenteditable",!0),e.find("figure").attr("contenteditable",!1),this.events(),this.backwardsCompatibility(),this.sorting()},s.prototype.events=function(){d(c).on("click",d.proxy(this,"unselectImage")).on("keydown",d.proxy(this,"removeImage")).on("click",".medium-insert-images-toolbar .medium-editor-action",d.proxy(this,"toolbarAction")).on("click",".medium-insert-images-toolbar2 .medium-editor-action",d.proxy(this,"toolbar2Action")),this.$el.on("click",".medium-insert-images img",d.proxy(this,"selectImage")),d(m).on("resize",d.proxy(this,"autoRepositionToolbars"))},s.prototype.backwardsCompatibility=function(){this.$el.find(".mediumInsert").removeClass("mediumInsert").addClass("medium-insert-images"),this.$el.find(".medium-insert-images.small").removeClass("small").addClass("medium-insert-images-left")},s.prototype.editorSerialize=function(){var i=this._serializePreImages();return d.each(i,function(e){var t=d("<div />").html(i[e].value);t.find(".medium-insert-images").find("p.figcaption, figure").removeAttr("contenteditable"),t.find(".medium-insert-images-progress").remove(),i[e].value=t.html()}),i},s.prototype.add=function(){var i=this,e=this.$el.find("#medium-insert-file-selector"),t={dataType:"json",add:function(e,t){d.proxy(i,"uploadAdd",e,t)()},done:function(e,t){d.proxy(i,"uploadDone",e,t)()}};(new XMLHttpRequest).upload&&(t.progress=function(e,t){d.proxy(i,"uploadProgress",e,t)()},t.progressall=function(e,t){d.proxy(i,"uploadProgressall",e,t)()}),e.fileupload(d.extend(!0,{},this.options.fileUploadOptions,t)),e.hasClass("skip-dialog")||e.click()},s.prototype.uploadAdd=function(e,t){var i,o=this.$el.find(".medium-insert-active"),s=this,n=[],r=t.files[0],a=this.options.fileUploadOptions.acceptFileTypes,l=this.options.fileUploadOptions.maxFileSize;if(a&&!a.test(r.type)?n.push(this.options.messages.acceptFileTypesError+r.name):l&&r.size>l&&n.push(this.options.messages.maxFileSizeError+r.name),0<n.length)return this.options.uploadFailed&&"function"==typeof this.options.uploadFailed?void this.options.uploadFailed(n,t):void alert(n.join("\n"));this.core.hideButtons(),o.is("p")&&(o.replaceWith('<div class="medium-insert-active">'+o.html()+"</div>"),(o=this.$el.find(".medium-insert-active")).next().is("p")||o.after("<p><br></p>"),this.core.moveCaret(o.next())),o.addClass("medium-insert-images"),!1===this.options.preview&&0===o.find("progress").length&&(new XMLHttpRequest).upload&&o.append(this.templates["src/js/templates/images-progressbar.hbs"]()),d(e.target).fileupload(),(t.autoUpload||!1!==t.autoUpload&&d(e.target).fileupload("option","autoUpload"))&&t.process().done(function(){s.options.preview?(i=c.createElement("img"),m.URL=m.URL||m.webkitURL,i.src=m.URL.createObjectURL(t.files[0]),i.onload=function(){d.proxy(s,"showImage",this.src,t)(),setTimeout(function(){m.URL.revokeObjectURL(this.src)})}):t.submit()})},s.prototype.uploadProgressall=function(e,t){var i;!1===this.options.preview&&(i=parseInt(t.loaded/t.total*100,10),(t=this.$el.find(".medium-insert-active").find("progress")).attr("value",i).text(i),100===i&&t.remove())},s.prototype.uploadProgress=function(e,t){var i;this.options.preview&&(i=100-parseInt(t.loaded/t.total*100,10),(t=t.context.find(".medium-insert-images-progress")).css("width",i+"%"),0==i&&t.remove())},s.prototype.uploadDone=function(e,t){d.proxy(this,"showImage",t.result.files[0].url,t)(),this.core.clean(),this.sorting()},s.prototype.showImage=function(e,t){var i,o=this.$el.find(".medium-insert-active"),s=function(e){var t=0;if(0===e.length)return t;for(var i=0;i<e.length;i++){var o=e.charCodeAt(i);t=(t<<5)-t+o,t&=t}return t}(t.files[0].name+t.files[0].size);return o.click(),o.addClass("contains-image-"+s),(i=this).options.preview&&t.context?((s=this.getDOMImage()).onload=function(){t.context.find("img").attr("src",e),this.options.uploadCompleted&&this.options.uploadCompleted(t.context,t),i.core.triggerInput()}.bind(this),s.src=e):(t.context=d(this.templates["src/js/templates/images-image.hbs"]({img:e,progress:this.options.preview})).appendTo(o),o.find("br").remove(),this.options.autoGrid&&o.find("figure").length>=this.options.autoGrid&&(d.each(this.options.styles,function(e,t){o.removeClass("medium-insert-images-"+e),t.removed&&t.removed(o)}),o.addClass("medium-insert-images-grid"),this.options.styles.grid.added&&this.options.styles.grid.added(o)),this.options.onImageSelect&&this.options.onImageSelect.call(this.options.context,t.files[0])),this.core.triggerInput(),t.context},s.prototype.getDOMImage=function(){return new m.Image},s.prototype.selectImage=function(e){var t,i=this;this.core.options.enabled&&(t=d(e.target),this.$currentImage=t,this.$el.blur(),t.addClass("medium-insert-image-active"),t.closest(".medium-insert-images").addClass("medium-insert-active"),setTimeout(function(){i.addToolbar(),i.options.captions&&i.core.addCaption(t.closest("figure"),i.options.captionPlaceholder)},50))},s.prototype.unselectImage=function(e){var t=d(e.target),e=this.$el.find(".medium-insert-image-active");if(t.is("img")&&t.hasClass("medium-insert-image-active"))return e.not(t).removeClass("medium-insert-image-active"),d(".medium-insert-images-toolbar, .medium-insert-images-toolbar2").remove(),void this.core.removeCaptions(t);e.removeClass("medium-insert-image-active"),d(".medium-insert-images-toolbar, .medium-insert-images-toolbar2").remove(),t.is(".medium-insert-caption-placeholder")?this.core.removeCaptionPlaceholder(e.closest("figure")):!1===t.is("p.figcaption")&&this.core.removeCaptions(),this.$currentImage=null},s.prototype.removeImage=function(e){var t,i,o,s,n,r=[],a=this.$el.find(".medium-insert-image-active");if((8===e.which||46===e.which)&&(a.length&&r.push(a),(o=m.getSelection())&&o.rangeCount&&(o="#text"===(a=o.getRangeAt(0).commonAncestorContainer).nodeName||"BR"===a.nodeName?d(a).parent():d(a),a=u.selection.getCaretOffsets(a).left,8===e.which&&0===a?s=o.prev():46===e.which&&a===o.text().length&&(s=o.next()),s&&s.hasClass("medium-insert-images")&&r.push(s.find("img")),(s=u.selection.getSelectionHtml(c))&&d("<div></div>").html(s).find(".medium-insert-images img").each(function(){r.push(d(this))})),r.length)){for(n=0;n<r.length;n++)this.deleteFile(r[n].attr("src"),r[n]),t=r[n].closest(".medium-insert-images"),r[n].closest("figure").remove(),0===t.find("figure").length&&(!1!==(i=t.next()).is("p")&&""===i.text()||(i=d(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),t.before(i)),t.remove());this.core.hideAddons(),!s&&i&&(e.preventDefault(),this.core.moveCaret(i)),d(".medium-insert-images-toolbar, .medium-insert-images-toolbar2").remove(),this.core.triggerInput()}},s.prototype.deleteFile=function(e,t){this.options.deleteScript&&("function"==typeof this.options.deleteScript?this.options.deleteScript(e,t):d.ajax(d.extend(!0,{},{url:this.options.deleteScript,type:this.options.deleteMethod||"POST",data:{file:e}},this.options.fileDeleteOptions)))},s.prototype.addToolbar=function(){var e,t,i,o;this.options.toolbar&&(e=this.$el.find(".medium-insert-image-active").closest(".medium-insert-images"),t=!1,o=this.core.getEditor().options.elementsContainer||"body",d(o).append(this.templates["src/js/templates/images-toolbar.hbs"]({styles:this.options.styles,actions:this.options.actions}).trim()),i=d(".medium-insert-images-toolbar"),o=d(".medium-insert-images-toolbar2"),i.find("button").each(function(){e.hasClass("medium-insert-images-"+d(this).data("action"))&&(d(this).addClass("medium-editor-button-active"),t=!0)}),!1===t&&i.find("button").first().addClass("medium-editor-button-active"),this.repositionToolbars(),i.fadeIn(),o.fadeIn())},s.prototype.autoRepositionToolbars=function(){setTimeout(function(){this.repositionToolbars(),this.repositionToolbars()}.bind(this),0)},s.prototype.repositionToolbars=function(){var e=d(".medium-insert-images-toolbar"),t=d(".medium-insert-images-toolbar2"),i=this.$el.find(".medium-insert-image-active"),o=this.core.getEditor().options.elementsContainer,s=-1<["absolute","fixed"].indexOf(m.getComputedStyle(o).getPropertyValue("position")),n=s?o.getBoundingClientRect():null,r=d(m).width(),a={};t.length&&(a.top=i.offset().top+2,a.left=i.offset().left+i.width()-t.width()-4,s&&(a.top+=o.scrollTop-n.top,a.left-=n.left,r=d(o).width()),a.left+t.width()>r&&(a.left=r-t.width()),t.css(a)),e.length&&(i.closest(".medium-insert-images-grid-active").length&&(i=i.closest(".medium-insert-images-grid-active")),a.top=i.offset().top-e.height()-8-2-5,a.left=i.offset().left+i.width()/2-e.width()/2,s&&(a.top+=o.scrollTop-n.top,a.left-=n.left),a.top<0&&(a.top=0),e.css(a))},s.prototype.toolbarAction=function(e){var t,i,o,s=this;null!==this.$currentImage&&(e=(i=(t=d(e.target).is("button")?d(e.target):d(e.target).closest("button")).closest("li")).closest("ul").find("li"),o=this.$el.find(".medium-insert-active"),t.addClass("medium-editor-button-active"),i.siblings().find(".medium-editor-button-active").removeClass("medium-editor-button-active"),e.find("button").each(function(){var e="medium-insert-images-"+d(this).data("action");d(this).hasClass("medium-editor-button-active")?(o.addClass(e),s.options.styles[d(this).data("action")].added&&s.options.styles[d(this).data("action")].added(o)):(o.removeClass(e),s.options.styles[d(this).data("action")].removed&&s.options.styles[d(this).data("action")].removed(o))}),this.core.hideButtons(),this.core.triggerInput())},s.prototype.toolbar2Action=function(e){null!==this.$currentImage&&(e=d(e.target).is("button")?d(e.target):d(e.target).closest("button"),(e=this.options.actions[e.data("action")].clicked)&&e(this.$el.find(".medium-insert-image-active")),this.core.hideButtons(),this.core.triggerInput())},s.prototype.sorting=function(){d.proxy(this.options.sorting,this)()},d.fn[i+t]=function(e){return this.each(function(){d.data(this,"plugin_"+i+t)||d.data(this,"plugin_"+i+t,new s(this,e))})}}(jQuery,window,document,u.util)});