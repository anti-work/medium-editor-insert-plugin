/*! 
 * medium-editor-insert-plugin v2.6.8 - jQuery insert plugin for MediumEditor
 *
 * http://linkesch.com/medium-editor-insert-plugin
 * 
 * Copyright (c) 2014 Pavel Linkesch (http://linkesch.com)
 * Released under the MIT license
 */


!function(t){"function"==typeof define&&define.amd?define(["jquery","handlebars","medium-editor","blueimp-file-upload"],t):"object"==typeof module&&module.exports?module.exports=function(e){if("undefined"==typeof window)throw new Error("medium-editor-insert-plugin runs only in a browser.");return void 0===e&&(e=require("jquery")),window.jQuery=e,Handlebars=require("handlebars"),MediumEditor=require("medium-editor"),require("blueimp-file-upload"),t(e,Handlebars,MediumEditor),e}:t(jQuery,Handlebars,MediumEditor)}(function(e,t,f){this.MediumInsert=this.MediumInsert||{},this.MediumInsert.Templates=this.MediumInsert.Templates||{},this.MediumInsert.Templates["src/js/templates/core-buttons.hbs"]=t.template({1:function(e,t,i,o,s){var n,r,a=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,d="function",m=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <li><button data-addon="'+e.escapeExpression(typeof(r=null!=(r=m(i,"key")||s&&m(s,"key"))?r:l)==d?r.call(a,{name:"key",hash:{},data:s,loc:{start:{line:5,column:36},end:{line:5,column:44}}}):r)+'" data-action="add" class="medium-insert-action" type="button">'+(null!=(n=typeof(r=null!=(r=m(i,"label")||(null!=t?m(t,"label"):t))?r:l)==d?r.call(a,{name:"label",hash:{},data:s,loc:{start:{line:5,column:107},end:{line:5,column:118}}}):r)?n:"")+"</button>\n            </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="medium-insert-buttons" contenteditable="false" style="display: none">\n    <button class="medium-insert-buttons-show" type="button"><span>+</span></button>\n    <ul class="medium-insert-buttons-addons" style="display: none">\n'+(null!=(n=r(i,"each").call(null!=t?t:e.nullContext||{},null!=t?r(t,"addons"):t,{name:"each",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s,loc:{start:{line:4,column:8},end:{line:7,column:17}}}))?n:"")+'        <input type="file" id="medium-insert-file-selector">\n    </ul>\n</div>\n'},useData:!0}),this.MediumInsert.Templates["src/js/templates/core-caption.hbs"]=t.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<p class="figcaption" contenteditable="true" class="medium-insert-caption-placeholder" data-placeholder="'+e.escapeExpression("function"==typeof(n=null!=(n=r(i,"placeholder")||(null!=t?r(t,"placeholder"):t))?n:e.hooks.helperMissing)?n.call(null!=t?t:e.nullContext||{},{name:"placeholder",hash:{},data:s,loc:{start:{line:1,column:105},end:{line:1,column:120}}}):n)+'"></figcaption>'},useData:!0}),this.MediumInsert.Templates["src/js/templates/core-empty-line.hbs"]=t.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){return"<p><br></p>\n"},useData:!0}),this.MediumInsert.Templates["src/js/templates/embeds-toolbar.hbs"]=t.template({1:function(e,t,i,o,s){var n,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="medium-insert-embeds-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active">\n        <ul class="medium-editor-toolbar-actions clearfix">\n'+(null!=(n=r(i,"each").call(null!=t?t:e.nullContext||{},null!=t?r(t,"styles"):t,{name:"each",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s,loc:{start:{line:4,column:12},end:{line:10,column:21}}}))?n:"")+"        </ul>\n    </div>\n"},2:function(e,t,i,o,s){var n,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(n=r(i,"if").call(null!=t?t:e.nullContext||{},null!=t?r(t,"label"):t,{name:"if",hash:{},fn:e.program(3,s,0),inverse:e.noop,data:s,loc:{start:{line:5,column:16},end:{line:9,column:23}}}))?n:""},3:function(e,t,i,o,s){var n,r,a=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,d="function",m=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                    <li>\n                        <button class="medium-editor-action" data-action="'+e.escapeExpression(typeof(r=null!=(r=m(i,"key")||s&&m(s,"key"))?r:l)==d?r.call(a,{name:"key",hash:{},data:s,loc:{start:{line:7,column:74},end:{line:7,column:82}}}):r)+'">'+(null!=(n=typeof(r=null!=(r=m(i,"label")||(null!=t?m(t,"label"):t))?r:l)==d?r.call(a,{name:"label",hash:{},data:s,loc:{start:{line:7,column:84},end:{line:7,column:95}}}):r)?n:"")+"</button>\n                    </li>\n"},5:function(e,t,i,o,s){var n,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <div class="medium-insert-embeds-toolbar2 medium-editor-toolbar medium-editor-toolbar-active">\n        <ul class="medium-editor-toolbar-actions clearfix">\n'+(null!=(n=r(i,"each").call(null!=t?t:e.nullContext||{},null!=t?r(t,"actions"):t,{name:"each",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s,loc:{start:{line:18,column:12},end:{line:24,column:21}}}))?n:"")+"        </ul>\n    </div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n,r=null!=t?t:e.nullContext||{},a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(n=a(i,"if").call(r,null!=t?a(t,"styles"):t,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s,loc:{start:{line:1,column:0},end:{line:13,column:7}}}))?n:"")+"\n"+(null!=(n=a(i,"if").call(r,null!=t?a(t,"actions"):t,{name:"if",hash:{},fn:e.program(5,s,0),inverse:e.noop,data:s,loc:{start:{line:15,column:0},end:{line:27,column:7}}}))?n:"")},useData:!0}),this.MediumInsert.Templates["src/js/templates/embeds-wrapper.hbs"]=t.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n,r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="medium-insert-embeds" contenteditable="false">\n\t<figure>\n\t\t<div class="medium-insert-embed">\n\t\t\t'+(null!=(n="function"==typeof(r=null!=(r=a(i,"html")||(null!=t?a(t,"html"):t))?r:e.hooks.helperMissing)?r.call(null!=t?t:e.nullContext||{},{name:"html",hash:{},data:s,loc:{start:{line:4,column:3},end:{line:4,column:13}}}):r)?n:"")+'\n\t\t</div>\n\t</figure>\n\t<div class="medium-insert-embeds-overlay"></div>\n</div>'},useData:!0}),this.MediumInsert.Templates["src/js/templates/images-image.hbs"]=t.template({1:function(e,t,i,o,s){return'        <div class="medium-insert-images-progress"></div>\n'},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n,r,a=null!=t?t:e.nullContext||{},l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<figure contenteditable="false">\n    <img src="'+e.escapeExpression("function"==typeof(r=null!=(r=l(i,"img")||(null!=t?l(t,"img"):t))?r:e.hooks.helperMissing)?r.call(a,{name:"img",hash:{},data:s,loc:{start:{line:2,column:14},end:{line:2,column:21}}}):r)+'" alt="" />\n'+(null!=(n=l(i,"if").call(a,null!=t?l(t,"progress"):t,{name:"if",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s,loc:{start:{line:3,column:4},end:{line:5,column:11}}}))?n:"")+"</figure>\n"},useData:!0}),this.MediumInsert.Templates["src/js/templates/images-progressbar.hbs"]=t.template({compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){return'<progress min="0" max="100" value="0">0</progress>'},useData:!0}),this.MediumInsert.Templates["src/js/templates/images-toolbar.hbs"]=t.template({1:function(e,t,i,o,s){var n,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(n=r(i,"if").call(null!=t?t:e.nullContext||{},null!=t?r(t,"label"):t,{name:"if",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s,loc:{start:{line:4,column:12},end:{line:8,column:19}}}))?n:""},2:function(e,t,i,o,s){var n,r,a=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,d="function",m=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <li>\n                    <button class="medium-editor-action" data-action="'+e.escapeExpression(typeof(r=null!=(r=m(i,"key")||s&&m(s,"key"))?r:l)==d?r.call(a,{name:"key",hash:{},data:s,loc:{start:{line:6,column:70},end:{line:6,column:78}}}):r)+'">'+(null!=(n=typeof(r=null!=(r=m(i,"label")||(null!=t?m(t,"label"):t))?r:l)==d?r.call(a,{name:"label",hash:{},data:s,loc:{start:{line:6,column:80},end:{line:6,column:91}}}):r)?n:"")+"</button>\n                </li>\n"},4:function(e,t,i,o,s){var n,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t<div class="medium-insert-images-toolbar2 medium-editor-toolbar medium-editor-toolbar-active">\n\t\t<ul class="medium-editor-toolbar-actions clearfix">\n'+(null!=(n=r(i,"each").call(null!=t?t:e.nullContext||{},null!=t?r(t,"actions"):t,{name:"each",hash:{},fn:e.program(5,s,0),inverse:e.noop,data:s,loc:{start:{line:16,column:9},end:{line:22,column:18}}}))?n:"")+"    \t</ul>\n    </div>\n"},5:function(e,t,i,o,s){var n,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(n=r(i,"if").call(null!=t?t:e.nullContext||{},null!=t?r(t,"label"):t,{name:"if",hash:{},fn:e.program(6,s,0),inverse:e.noop,data:s,loc:{start:{line:17,column:13},end:{line:21,column:20}}}))?n:""},6:function(e,t,i,o,s){var n,r,a=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,d="function",m=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        \t        <li>\n        \t            <button class="medium-editor-action" data-action="'+e.escapeExpression(typeof(r=null!=(r=m(i,"key")||s&&m(s,"key"))?r:l)==d?r.call(a,{name:"key",hash:{},data:s,loc:{start:{line:19,column:71},end:{line:19,column:79}}}):r)+'">'+(null!=(n=typeof(r=null!=(r=m(i,"label")||(null!=t?m(t,"label"):t))?r:l)==d?r.call(a,{name:"label",hash:{},data:s,loc:{start:{line:19,column:81},end:{line:19,column:92}}}):r)?n:"")+"</button>\n        \t        </li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,i,o,s){var n,r=null!=t?t:e.nullContext||{},a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active">\n    <ul class="medium-editor-toolbar-actions clearfix">\n'+(null!=(n=a(i,"each").call(r,null!=t?a(t,"styles"):t,{name:"each",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s,loc:{start:{line:3,column:8},end:{line:9,column:17}}}))?n:"")+"    </ul>\n</div>\n\n"+(null!=(n=a(i,"if").call(r,null!=t?a(t,"actions"):t,{name:"if",hash:{},fn:e.program(4,s,0),inverse:e.noop,data:s,loc:{start:{line:13,column:0},end:{line:25,column:7}}}))?n:"")},useData:!0}),window.MediumInsert=this.MediumInsert,function(l,d,r,o){"use strict";var s="mediumInsert",n={editor:null,enabled:!0,addons:{images:!0,embeds:!0}};function a(e){return e.charAt(0).toUpperCase()+e.slice(1)}function m(e,t){var i;this.el=e,this.$el=l(e),this.templates=d.MediumInsert.Templates,t&&(i=t.editor,t.editor=null),this.options=l.extend(!0,{},n,t),this.options.editor=i,t&&(t.editor=i),this._defaults=n,this._name=s,this.options&&this.options.editor&&(this.options.editor._serialize===o&&(this.options.editor._serialize=this.options.editor.serialize),this.options.editor._destroy===o&&(this.options.editor._destroy=this.options.editor.destroy),this.options.editor._setup===o&&(this.options.editor._setup=this.options.editor.setup),this.options.editor._hideInsertButtons=this.hideButtons,this.options.editor.serialize=this.editorSerialize,this.options.editor.destroy=this.editorDestroy,this.options.editor.setup=this.editorSetup,this.options.editor.getExtensionByName("placeholder")!==o&&(this.options.editor.getExtensionByName("placeholder").updatePlaceholder=this.editorUpdatePlaceholder))}m.prototype.init=function(){this.$el.addClass("medium-editor-insert-plugin"),"object"==typeof this.options.addons&&0!==Object.keys(this.options.addons).length||this.disable(),this.initAddons(),this.clean(),this.events()},m.prototype.events=function(){var t=this;this.$el.on("dragover drop",function(e){e.preventDefault()}).on("keyup click",l.proxy(this,"toggleButtons")).on("selectstart mousedown",".medium-insert, .medium-insert-buttons",l.proxy(this,"disableSelection")).on("click",".medium-insert-buttons-show",l.proxy(this,"toggleAddons")).on("click",".medium-insert-action",l.proxy(this,"addonAction")).on("mousedown",".medium-insert-images img",function(){return!1}).on("paste",".medium-insert-caption-placeholder",function(e){l.proxy(t,"removeCaptionPlaceholder")(l(e.target))}),l(d).on("resize",l.proxy(this,"positionButtons",null))},m.prototype.getEditor=function(){return this.options.editor},m.prototype.editorSerialize=function(){var i=this._serialize();return l.each(i,function(e){var t=l("<div />").html(i[e].value);t.find(".medium-insert-buttons").remove(),t.find(".medium-insert-active").removeClass("medium-insert-active"),t.find("[data-embed-code]").each(function(){var e=l(this),t=l("<div />").html(e.attr("data-embed-code")).text();e.html(t)}),i[e].value=t.html()}),i},m.prototype.editorDestroy=function(){l.each(this.elements,function(e,t){l(t).data("plugin_"+s)instanceof m&&l(t).data("plugin_"+s).disable()}),this._destroy()},m.prototype.editorSetup=function(){this._setup(),l.each(this.elements,function(e,t){l(t).data("plugin_"+s)instanceof m&&l(t).data("plugin_"+s).enable()})},m.prototype.editorUpdatePlaceholder=function(e,t){var i=l(e).children().not(".medium-insert-buttons").contents();t||1!==i.length||"br"!==i[0].nodeName.toLowerCase()?this.hidePlaceholder(e):(this.showPlaceholder(e),this.base._hideInsertButtons(l(e)))},m.prototype.triggerInput=function(){this.getEditor()&&this.getEditor().trigger("editableInput",null,this.el)},m.prototype.deselect=function(){r.getSelection().removeAllRanges()},m.prototype.disable=function(){this.options.enabled=!1,this.$el.find(".medium-insert-buttons").addClass("hide")},m.prototype.enable=function(){this.options.enabled=!0,this.$el.find(".medium-insert-buttons").removeClass("hide")},m.prototype.disableSelection=function(e){var t=l(e.target);!1!==t.is("img")&&!t.hasClass("medium-insert-buttons-show")||e.preventDefault()},m.prototype.initAddons=function(){var o=this;this.options.addons&&0!==this.options.addons.length&&l.each(this.options.addons,function(e,t){var i=s+a(e);!1!==t?(o.$el[i](t),o.options.addons[e]=o.$el.data("plugin_"+i).options):delete o.options.addons[e]})},m.prototype.clean=function(){var e,t,i=this;!1!==this.options.enabled&&(0===this.$el.html().length&&this.$el.html(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),this.$el.contents().filter(function(){return"#text"===this.nodeName&&""!==l.trim(l(this).text())||"br"===this.nodeName.toLowerCase()}).each(function(){l(this).wrap("<p />"),i.moveCaret(l(this).parent(),l(this).text().length)}),this.addButtons(),(t=(e=this.$el.find(".medium-insert-buttons")).prev()).attr("class")&&t.attr("class").match(/medium\-insert(?!\-active)/)&&e.before(this.templates["src/js/templates/core-empty-line.hbs"]().trim()))},m.prototype.getButtons=function(){if(!1!==this.options.enabled)return this.templates["src/js/templates/core-buttons.hbs"]({addons:this.options.addons}).trim()},m.prototype.addButtons=function(){0===this.$el.find(".medium-insert-buttons").length&&this.$el.append(this.getButtons())},m.prototype.toggleButtons=function(e){var t,i,o,s,n=l(e.target),r=d.getSelection(),a=this;!1!==this.options.enabled&&((i=r&&0!==r.rangeCount?(t=r.getRangeAt(0),l(t.commonAncestorContainer)):n).hasClass("medium-editor-insert-plugin")&&(i=i.find("p:first")),o=i.is("p")?i:i.closest("p"),this.clean(),!1===n.hasClass("medium-editor-placeholder")&&0===n.closest(".medium-insert-buttons").length&&0===i.closest(".medium-insert-buttons").length&&(this.$el.find(".medium-insert-active").removeClass("medium-insert-active"),l.each(this.options.addons,function(e){if(n.closest(".medium-insert-"+e).length&&(i=n),i.closest(".medium-insert-"+e).length)return o=i.closest(".medium-insert-"+e),void(s=e)}),o.length&&(""===o.text().trim()&&!s||"images"===s)?(o.addClass("medium-insert-active"),"images"===s?this.$el.find(".medium-insert-buttons").attr("data-active-addon",s):this.$el.find(".medium-insert-buttons").removeAttr("data-active-addon"),setTimeout(function(){s||(a.positionButtons(s),a.showButtons(s))},s?100:0)):this.hideButtons()))},m.prototype.showButtons=function(e){var t=this.$el.find(".medium-insert-buttons");t.show(),t.find("li").show(),e&&(t.find("li").hide(),t.find('button[data-addon="'+e+'"]').parent().show())},m.prototype.hideButtons=function(e){(e=e||this.$el).find(".medium-insert-buttons").hide(),e.find(".medium-insert-buttons-addons").hide(),e.find(".medium-insert-buttons-show").removeClass("medium-insert-buttons-rotate")},m.prototype.positionButtons=function(e){var t=this.$el.find(".medium-insert-buttons"),i=this.$el.find(".medium-insert-active"),o=i.hasClass("medium-insert-images-grid")?[]:i.find("figure:last p.figcaption"),s=this.getEditor()?this.getEditor().options.elementsContainer:l("body").get(0),n=-1<["absolute","fixed"].indexOf(d.getComputedStyle(s).getPropertyValue("position")),r={};i.length&&(r.left=i.position().left,r.top=i.position().top,e?(r.left+=i.width()-t.find(".medium-insert-buttons-show").width()-10,r.top+=i.height()-20+(o.length?-o.height()-parseInt(o.css("margin-top"),10):10)):(r.left+=-parseInt(t.find(".medium-insert-buttons-addons").css("left"),10)-parseInt(t.find(".medium-insert-buttons-addons button:first").css("margin-left"),10),r.top+=parseInt(i.css("margin-top"),10)),n&&(r.top+=s.scrollTop),!1===this.$el.hasClass("medium-editor-placeholder")&&r.left<0&&(r.left=i.position().left),t.css(r))},m.prototype.toggleAddons=function(){"images"!==this.$el.find(".medium-insert-buttons").attr("data-active-addon")?(this.$el.find(".medium-insert-buttons-addons").fadeToggle(),this.$el.find(".medium-insert-buttons-show").toggleClass("medium-insert-buttons-rotate")):this.$el.find(".medium-insert-buttons").find('button[data-addon="images"]').click()},m.prototype.hideAddons=function(){this.$el.find(".medium-insert-buttons-addons").hide(),this.$el.find(".medium-insert-buttons-show").removeClass("medium-insert-buttons-rotate")},m.prototype.addonAction=function(e){var t=l(e.currentTarget),i=t.data("addon"),o=t.data("action");this.$el.data("plugin_"+s+a(i))[o]()},m.prototype.moveCaret=function(e,t){var i,o,s,n;t=t||0,i=r.createRange(),o=d.getSelection(),(s=e.get(0)).childNodes.length||(n=r.createTextNode(" "),s.appendChild(n)),i.setStart(s.childNodes[0],t),i.collapse(!0),o.removeAllRanges(),o.addRange(i)},m.prototype.addCaption=function(e,t){0===e.find("p.figcaption").length&&e.append(this.templates["src/js/templates/core-caption.hbs"]({placeholder:t}))},m.prototype.removeCaptions=function(e){var t=this.$el.find("p.figcaption");e&&(t=t.not(e)),t.each(function(){!l(this).hasClass("medium-insert-caption-placeholder")&&""!==l(this).text().trim()||l(this).remove()})},m.prototype.removeCaptionPlaceholder=function(e){var t=e.is("p.figcaption")?e:e.find("p.figcaption");t.length&&t.removeClass("medium-insert-caption-placeholder").removeAttr("data-placeholder")},l.fn[s]=function(i){return this.each(function(){var e,t=this;l(t).is("textarea")&&(e=l(t).attr("medium-editor-textarea-id"),t=l(t).siblings('[medium-editor-textarea-id="'+e+'"]').get(0)),l.data(t,"plugin_"+s)?"string"==typeof i&&l.data(t,"plugin_"+s)[i]&&l.data(t,"plugin_"+s)[i]():(l.data(t,"plugin_"+s,new m(t,i)),l.data(t,"plugin_"+s).init())})}}(jQuery,window,document),function(c,u,p){"use strict";var i="mediumInsert",t="Embeds",o={label:'<span class="fa fa-youtube-play"></span>',placeholder:"Paste a YouTube, Vimeo, Facebook, Twitter or Instagram link and press Enter",oembedProxy:"http://medium.iframe.ly/api/oembed?iframe=1",captions:!0,captionPlaceholder:"Type caption (optional)",storeMeta:!1,styles:{wide:{label:'<span class="fa fa-align-justify"></span>'},left:{label:'<span class="fa fa-align-left"></span>'},right:{label:'<span class="fa fa-align-right"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(){var e=c.Event("keydown");e.which=8,c(p).trigger(e)}}},parseOnPaste:!1};function s(e,t){this.el=e,this.$el=c(e),this.templates=u.MediumInsert.Templates,this.core=this.$el.data("plugin_"+i),this.options=c.extend(!0,{},o,t),this._defaults=o,this._name=i,this.core.getEditor()&&(this.core.getEditor()._serializePreEmbeds=this.core.getEditor().serialize,this.core.getEditor().serialize=this.editorSerialize),this.init()}s.prototype.init=function(){var e=this.$el.find(".medium-insert-embeds");e.attr("contenteditable",!1),e.each(function(){0===c(this).find(".medium-insert-embeds-overlay").length&&c(this).append(c("<div />").addClass("medium-insert-embeds-overlay"))}),this.events(),this.backwardsCompatibility()},s.prototype.events=function(){c(p).on("click",c.proxy(this,"unselectEmbed")).on("keydown",c.proxy(this,"removeEmbed")).on("click",".medium-insert-embeds-toolbar .medium-editor-action",c.proxy(this,"toolbarAction")).on("click",".medium-insert-embeds-toolbar2 .medium-editor-action",c.proxy(this,"toolbar2Action")),this.$el.on("keyup click paste",c.proxy(this,"togglePlaceholder")).on("keydown",c.proxy(this,"processLink")).on("click",".medium-insert-embeds-overlay",c.proxy(this,"selectEmbed")).on("contextmenu",".medium-insert-embeds-placeholder",c.proxy(this,"fixRightClickOnPlaceholder")),this.options.parseOnPaste&&this.$el.on("paste",c.proxy(this,"processPasted")),c(u).on("resize",c.proxy(this,"autoRepositionToolbars"))},s.prototype.backwardsCompatibility=function(){var e=this;this.$el.find(".mediumInsert-embeds").removeClass("mediumInsert-embeds").addClass("medium-insert-embeds"),this.$el.find(".medium-insert-embeds").each(function(){0===c(this).find(".medium-insert-embed").length&&(c(this).after(e.templates["src/js/templates/embeds-wrapper.hbs"]({html:c(this).html()})),c(this).remove())})},s.prototype.editorSerialize=function(){var o=this._serializePreEmbeds();return c.each(o,function(e){var t=c("<div />").html(o[e].value),i=t.find(".medium-insert-embeds");i.removeAttr("contenteditable"),i.find("p.figcaption").removeAttr("contenteditable"),t.find(".medium-insert-embeds-overlay").remove(),o[e].value=t.html()}),o},s.prototype.add=function(){var e=this.$el.find(".medium-insert-active");e.html(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),e.is("p")&&(e.replaceWith('<div class="medium-insert-active">'+e.html()+"</div>"),e=this.$el.find(".medium-insert-active"),this.core.moveCaret(e)),e.addClass("medium-insert-embeds medium-insert-embeds-input medium-insert-embeds-active"),this.togglePlaceholder({target:e.get(0)}),e.click(),this.core.hideButtons()},s.prototype.togglePlaceholder=function(e){var t,i,o,s=c(e.target),n=u.getSelection();n&&0!==n.rangeCount&&(t=n.getRangeAt(0),(i=c(t.commonAncestorContainer)).hasClass("medium-insert-embeds-active")?s=i:i.closest(".medium-insert-embeds-active").length&&(s=i.closest(".medium-insert-embeds-active")),s.hasClass("medium-insert-embeds-active")?""===(o=s.text().trim())&&!1===s.hasClass("medium-insert-embeds-placeholder")?s.addClass("medium-insert-embeds-placeholder").attr("data-placeholder",this.options.placeholder):""!==o&&s.hasClass("medium-insert-embeds-placeholder")&&s.removeClass("medium-insert-embeds-placeholder").removeAttr("data-placeholder"):this.$el.find(".medium-insert-embeds-active").remove())},s.prototype.fixRightClickOnPlaceholder=function(e){this.core.moveCaret(c(e.target))},s.prototype.processLink=function(e){var t,i=this.$el.find(".medium-insert-embeds-active");i.length&&(""!==(t=i.text().trim())||-1===[8,46,13].indexOf(e.which)?13===e.which&&(e.preventDefault(),e.stopPropagation(),this.options.oembedProxy?this.oembed(t):this.parseUrl(t)):i.remove())},s.prototype.processPasted=function(e){var t;c(".medium-insert-embeds-active").length||(t=e.originalEvent.clipboardData.getData("text"),new RegExp("^(http(s?):)?//","i").test(t)&&(this.options.oembedProxy?this.oembed(t,!0):this.parseUrl(t,!0)))},s.prototype.oembed=function(s,i){var n=this;c.support.cors=!0,c.ajax({crossDomain:!0,cache:!1,url:this.options.oembedProxy,dataType:"json",data:{url:s},success:function(e){var t=e&&e.html;n.options.storeMeta&&(t+='<div class="medium-insert-embeds-meta"><script type="text/json">'+JSON.stringify(e)+"<\/script></div>"),e&&!t&&"photo"===e.type&&e.url&&(t='<img src="'+e.url+'" alt="">'),t?i?c.proxy(n,"embed",t,s)():c.proxy(n,"embed",t)():c.proxy(n,"convertBadEmbed",s)()},error:function(e,t,i){var o=function(){try{return JSON.parse(e.responseText)}catch(e){}}();void 0!==u.console?u.console.log(o&&o.error||e.status||i.message):u.alert("Error requesting media from "+n.options.oembedProxy+" to insert: "+i+" (response status: "+e.status+")"),c.proxy(n,"convertBadEmbed",s)()}})},s.prototype.parseUrl=function(e,t){var i;return new RegExp(["youtube","youtu.be","vimeo","instagram","twitter","facebook"].join("|")).test(e)?(i=e.replace(/\n?/g,"").replace(/^((http(s)?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/(watch\?v=|v\/)?)([a-zA-Z0-9\-_]+)(.*)?$/,'<div class="video video-youtube"><iframe width="420" height="315" src="//www.youtube.com/embed/$7" frameborder="0" allowfullscreen></iframe></div>').replace(/^https?:\/\/vimeo\.com(\/.+)?\/([0-9]+)$/,'<div class="video video-vimeo"><iframe src="//player.vimeo.com/video/$2" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>').replace(/^https:\/\/twitter\.com\/(\w+)\/status\/(\d+)\/?$/,'<blockquote class="twitter-tweet" align="center" lang="en"><a href="https://twitter.com/$1/statuses/$2"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"><\/script>').replace(/^(https:\/\/www\.facebook\.com\/(.*))$/,'<script src="//connect.facebook.net/en_US/sdk.js#xfbml=1&amp;version=v2.2" async><\/script><div class="fb-post" data-href="$1"><div class="fb-xfbml-parse-ignore"><a href="$1">Loading Facebook post...</a></div></div>').replace(/^https?:\/\/instagram\.com\/p\/(.+)\/?$/,'<span class="instagram"><iframe src="//instagram.com/p/$1/embed/" width="612" height="710" frameborder="0" scrolling="no" allowtransparency="true"></iframe></span>'),this.options.storeMeta&&(i+='<div class="medium-insert-embeds-meta"><script type="text/json">'+JSON.stringify({})+"<\/script></div>"),!1===/<("[^"]*"|'[^']*'|[^'">])*>/.test(i)?(c.proxy(this,"convertBadEmbed",e)(),!1):void(t?this.embed(i,e):this.embed(i))):(c.proxy(this,"convertBadEmbed",e)(),!1)},s.prototype.embed=function(e,t){var i,o=this.$el.find(".medium-insert-embeds-active");if(!e)return alert("Incorrect URL format specified"),!1;-1<e.indexOf("<\/script>")&&(i=c("<div>").attr("data-embed-code",c("<div />").text(e).html()).html(e),e=c("<div>").append(i).html()),t?((o=this.$el.find(":not(iframe, script, style)").contents().filter(function(){return 3===this.nodeType&&-1<this.textContent.indexOf(t)}).parent()).after(this.templates["src/js/templates/embeds-wrapper.hbs"]({html:e})),o.text(o.text().replace(t,"")),o.after(this.templates["src/js/templates/core-empty-line.hbs"]().trim())):(o.after(this.templates["src/js/templates/embeds-wrapper.hbs"]({html:e})),o.remove()),this.core.triggerInput(),-1!==e.indexOf("facebook")&&"undefined"!=typeof FB&&setTimeout(function(){FB.XFBML.parse()},2e3)},s.prototype.convertBadEmbed=function(e){var t,i,o,s=this.templates["src/js/templates/core-empty-line.hbs"]().trim();t=this.$el.find(".medium-insert-embeds-active"),o=c(s),t.before(o),t.remove(),o.html(e),i=c(s),o.after(i),this.core.triggerInput(),this.core.moveCaret(i)},s.prototype.selectEmbed=function(e){var t,i=this;this.core.options.enabled&&((t=c(e.target).hasClass("medium-insert-embeds")?c(e.target):c(e.target).closest(".medium-insert-embeds")).addClass("medium-insert-embeds-selected"),setTimeout(function(){i.addToolbar(),i.options.captions&&i.core.addCaption(t.find("figure"),i.options.captionPlaceholder)},50))},s.prototype.unselectEmbed=function(e){var t=c(e.target).hasClass("medium-insert-embeds")?c(e.target):c(e.target).closest(".medium-insert-embeds"),i=this.$el.find(".medium-insert-embeds-selected");if(t.hasClass("medium-insert-embeds-selected"))return i.not(t).removeClass("medium-insert-embeds-selected"),c(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),this.core.removeCaptions(t.find("p.figcaption")),void((c(e.target).is(".medium-insert-caption-placeholder")||c(e.target).is("p.figcaption"))&&(t.removeClass("medium-insert-embeds-selected"),this.core.removeCaptionPlaceholder(t.find("figure"))));i.removeClass("medium-insert-embeds-selected"),c(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),c(e.target).is(".medium-insert-caption-placeholder")?this.core.removeCaptionPlaceholder(t.find("figure")):!1===c(e.target).is("p.figcaption")&&this.core.removeCaptions()},s.prototype.removeEmbed=function(e){var t,i,o,s,n,r,a,l,d=[],m=this.$el.find(".medium-insert-embeds-selected");if(8!==e.which&&46!==e.which||(m.length&&d.push(m),(i=u.getSelection())&&i.rangeCount&&(n="#text"===(o=i.getRangeAt(0).commonAncestorContainer).nodeName||"BR"===o.nodeName?c(o).parent():c(o),s=f.selection.getCaretOffsets(o).left,8===e.which&&0===s?r=n.prev():46===e.which&&s===n.text().length&&(r=n.next()),r&&r.hasClass("medium-insert-embeds")&&d.push(r),(a=f.selection.getSelectionHtml(p))&&c("<div></div>").html(a).find(".medium-insert-embeds").each(function(){d.push(c(this))}))),d.length){for(l=0;l<d.length;l++)e.preventDefault(),c(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),t=c(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),d[l].before(t),d[l].remove(),this.core.hideAddons(),this.core.moveCaret(t),this.core.triggerInput();this.core.hideAddons(),!a&&t&&(e.preventDefault(),this.core.moveCaret(t)),c(".medium-insert-embeds-toolbar, .medium-insert-embeds-toolbar2").remove(),this.core.triggerInput()}},s.prototype.addToolbar=function(){if(this.options.toolbar){var e,t,i,o=this.$el.find(".medium-insert-embeds-selected"),s=!1;if(0===o.length)return;i=this.core.getEditor().options.elementsContainer||"body",c(i).append(this.templates["src/js/templates/embeds-toolbar.hbs"]({styles:this.options.styles,actions:this.options.actions}).trim()),e=c(".medium-insert-embeds-toolbar"),t=c(".medium-insert-embeds-toolbar2"),e.find("button").each(function(){o.hasClass("medium-insert-embeds-"+c(this).data("action"))&&(c(this).addClass("medium-editor-button-active"),s=!0)}),!1===s&&e.find("button").first().addClass("medium-editor-button-active"),this.repositionToolbars(),e.fadeIn(),t.fadeIn()}},s.prototype.autoRepositionToolbars=function(){setTimeout(function(){this.repositionToolbars(),this.repositionToolbars()}.bind(this),0)},s.prototype.repositionToolbars=function(){var e=c(".medium-insert-embeds-toolbar"),t=c(".medium-insert-embeds-toolbar2"),i=this.$el.find(".medium-insert-embeds-selected"),o=this.core.getEditor().options.elementsContainer,s=-1<["absolute","fixed"].indexOf(u.getComputedStyle(o).getPropertyValue("position")),n=s?o.getBoundingClientRect():null,r=c(u).width(),a={};t.length&&(a.top=i.offset().top+2,a.left=i.offset().left+i.width()-t.width()-4,s&&(a.top+=o.scrollTop-n.top,a.left-=n.left,r=c(o).width()),a.left+t.width()>r&&(a.left=r-t.width()),t.css(a)),e.length&&(a.left=i.offset().left+i.width()/2-e.width()/2,a.top=i.offset().top-e.height()-8-2-5,s&&(a.top+=o.scrollTop-n.top,a.left-=n.left),a.top<0&&(a.top=0),e.css(a))},s.prototype.toolbarAction=function(e){var t=c(e.target).is("button")?c(e.target):c(e.target).closest("button"),i=t.closest("li"),o=i.closest("ul").find("li"),s=this.$el.find(".medium-insert-embeds-selected"),n=this;t.addClass("medium-editor-button-active"),i.siblings().find(".medium-editor-button-active").removeClass("medium-editor-button-active"),o.find("button").each(function(){var e="medium-insert-embeds-"+c(this).data("action");c(this).hasClass("medium-editor-button-active")?(s.addClass(e),(n.options.styles[c(this).data("action")]||{}).added&&n.options.styles[c(this).data("action")].added(s)):(s.removeClass(e),(n.options.styles[c(this).data("action")]||{}).removed&&n.options.styles[c(this).data("action")].removed(s))}),this.core.triggerInput()},s.prototype.toolbar2Action=function(e){var t=c(e.target).is("button")?c(e.target):c(e.target).closest("button"),i=(this.options.actions[t.data("action")]||{}).clicked;i&&i(this.$el.find(".medium-insert-embeds-selected")),this.core.triggerInput()},c.fn[i+t]=function(e){return this.each(function(){c.data(this,"plugin_"+i+t)||c.data(this,"plugin_"+i+t,new s(this,e))})}}(jQuery,window,document),function(u,p,h){"use strict";var i="mediumInsert",t="Images",o={label:'<span class="fa fa-camera"></span>',deleteMethod:"POST",deleteScript:"delete.php",preview:!0,captions:!0,captionPlaceholder:"Type caption for image (optional)",autoGrid:3,fileUploadOptions:{url:null,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i},fileDeleteOptions:{},styles:{wide:{label:'<span class="fa fa-align-justify"></span>'},left:{label:'<span class="fa fa-align-left"></span>'},right:{label:'<span class="fa fa-align-right"></span>'},grid:{label:'<span class="fa fa-th"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(){var e=u.Event("keydown");e.which=8,u(h).trigger(e)}}},sorting:function(){},messages:{acceptFileTypesError:"This file is not in a supported format: ",maxFileSizeError:"This file is too big: "}};function s(e,t){this.el=e,this.$el=u(e),this.$currentImage=null,this.templates=p.MediumInsert.Templates,this.core=this.$el.data("plugin_"+i),this.options=u.extend(!0,{},o,t),this._defaults=o,this._name=i,this.options.preview&&!p.FileReader&&(this.options.preview=!1),this.core.getEditor()&&(this.core.getEditor()._serializePreImages=this.core.getEditor().serialize,this.core.getEditor().serialize=this.editorSerialize),this.init()}s.prototype.init=function(){var e=this.$el.find(".medium-insert-images");e.find("p.figcaption").attr("contenteditable",!0),e.find("figure").attr("contenteditable",!1),this.events(),this.backwardsCompatibility(),this.sorting()},s.prototype.events=function(){u(h).on("click",u.proxy(this,"unselectImage")).on("keydown",u.proxy(this,"removeImage")).on("click",".medium-insert-images-toolbar .medium-editor-action",u.proxy(this,"toolbarAction")).on("click",".medium-insert-images-toolbar2 .medium-editor-action",u.proxy(this,"toolbar2Action")),this.$el.on("click",".medium-insert-images img",u.proxy(this,"selectImage")),u(p).on("resize",u.proxy(this,"autoRepositionToolbars"))},s.prototype.backwardsCompatibility=function(){this.$el.find(".mediumInsert").removeClass("mediumInsert").addClass("medium-insert-images"),this.$el.find(".medium-insert-images.small").removeClass("small").addClass("medium-insert-images-left")},s.prototype.editorSerialize=function(){var i=this._serializePreImages();return u.each(i,function(e){var t=u("<div />").html(i[e].value);t.find(".medium-insert-images").find("p.figcaption, figure").removeAttr("contenteditable"),t.find(".medium-insert-images-progress").remove(),i[e].value=t.html()}),i},s.prototype.add=function(){var i=this,e=this.$el.find("#medium-insert-file-selector"),t={dataType:"json",add:function(e,t){u.proxy(i,"uploadAdd",e,t)()},done:function(e,t){u.proxy(i,"uploadDone",e,t)()}};(new XMLHttpRequest).upload&&(t.progress=function(e,t){u.proxy(i,"uploadProgress",e,t)()},t.progressall=function(e,t){u.proxy(i,"uploadProgressall",e,t)()}),e.fileupload(u.extend(!0,{},this.options.fileUploadOptions,t)),e.hasClass("skip-dialog")||e.click()},s.prototype.uploadAdd=function(e,t){var i,o=this.$el.find(".medium-insert-active"),s=this,n=[],r=t.files[0],a=this.options.fileUploadOptions.acceptFileTypes,l=this.options.fileUploadOptions.maxFileSize;if(a&&!a.test(r.type)?n.push(this.options.messages.acceptFileTypesError+r.name):l&&r.size>l&&n.push(this.options.messages.maxFileSizeError+r.name),0<n.length)return this.options.uploadFailed&&"function"==typeof this.options.uploadFailed?void this.options.uploadFailed(n,t):void alert(n.join("\n"));this.core.hideButtons(),o.is("p")&&(o.replaceWith('<div class="medium-insert-active">'+o.html()+"</div>"),(o=this.$el.find(".medium-insert-active")).next().is("p")||o.after("<p><br></p>"),this.core.moveCaret(o.next())),o.addClass("medium-insert-images"),!1===this.options.preview&&0===o.find("progress").length&&(new XMLHttpRequest).upload&&o.append(this.templates["src/js/templates/images-progressbar.hbs"]()),u(e.target).fileupload(),(t.autoUpload||!1!==t.autoUpload&&u(e.target).fileupload("option","autoUpload"))&&t.process().done(function(){s.options.preview?(i=h.createElement("img"),p.URL=p.URL||p.webkitURL,i.src=p.URL.createObjectURL(t.files[0]),i.onload=function(){u.proxy(s,"showImage",this.src,t)(),setTimeout(function(){p.URL.revokeObjectURL(this.src)})}):t.submit()})},s.prototype.uploadProgressall=function(e,t){var i,o;!1===this.options.preview&&(i=parseInt(t.loaded/t.total*100,10),(o=this.$el.find(".medium-insert-active").find("progress")).attr("value",i).text(i),100===i&&o.remove())},s.prototype.uploadProgress=function(e,t){var i,o;this.options.preview&&(i=100-parseInt(t.loaded/t.total*100,10),(o=t.context.find(".medium-insert-images-progress")).css("width",i+"%"),0==i&&o.remove())},s.prototype.uploadDone=function(e,t){u.proxy(this,"showImage",t.result.files[0].url,t)(),this.core.clean(),this.sorting()},s.prototype.showImage=function(e,t){var i,o,s=this.$el.find(".medium-insert-active"),n=function(e){var t=0;if(0===e.length)return t;for(var i=0;i<e.length;i++){var o=e.charCodeAt(i);t=(t<<5)-t+o,t&=t}return t}(t.files[0].name+t.files[0].size);return s.click(),s.addClass("contains-image-"+n),(o=this).options.preview&&t.context?((i=this.getDOMImage()).onload=function(){t.context.find("img").attr("src",e),this.options.uploadCompleted&&this.options.uploadCompleted(t.context,t),o.core.triggerInput()}.bind(this),i.src=e):(t.context=u(this.templates["src/js/templates/images-image.hbs"]({img:e,progress:this.options.preview})).appendTo(s),s.find("br").remove(),this.options.autoGrid&&s.find("figure").length>=this.options.autoGrid&&(u.each(this.options.styles,function(e,t){var i="medium-insert-images-"+e;s.removeClass(i),t.removed&&t.removed(s)}),s.addClass("medium-insert-images-grid"),this.options.styles.grid.added&&this.options.styles.grid.added(s)),this.options.onImageSelect&&this.options.onImageSelect.call(this.options.context,t.files[0])),this.core.triggerInput(),t.context},s.prototype.getDOMImage=function(){return new p.Image},s.prototype.selectImage=function(e){var t,i=this;this.core.options.enabled&&(t=u(e.target),this.$currentImage=t,this.$el.blur(),t.addClass("medium-insert-image-active"),t.closest(".medium-insert-images").addClass("medium-insert-active"),setTimeout(function(){i.addToolbar(),i.options.captions&&i.core.addCaption(t.closest("figure"),i.options.captionPlaceholder)},50))},s.prototype.unselectImage=function(e){var t=u(e.target),i=this.$el.find(".medium-insert-image-active");if(t.is("img")&&t.hasClass("medium-insert-image-active"))return i.not(t).removeClass("medium-insert-image-active"),u(".medium-insert-images-toolbar, .medium-insert-images-toolbar2").remove(),void this.core.removeCaptions(t);i.removeClass("medium-insert-image-active"),u(".medium-insert-images-toolbar, .medium-insert-images-toolbar2").remove(),t.is(".medium-insert-caption-placeholder")?this.core.removeCaptionPlaceholder(i.closest("figure")):!1===t.is("p.figcaption")&&this.core.removeCaptions(),this.$currentImage=null},s.prototype.removeImage=function(e){var t,i,o,s,n,r,a,l,d,m=[],c=this.$el.find(".medium-insert-image-active");if((8===e.which||46===e.which)&&(c.length&&m.push(c),(o=p.getSelection())&&o.rangeCount&&(r="#text"===(s=o.getRangeAt(0).commonAncestorContainer).nodeName||"BR"===s.nodeName?u(s).parent():u(s),n=f.selection.getCaretOffsets(s).left,8===e.which&&0===n?a=r.prev():46===e.which&&n===r.text().length&&(a=r.next()),a&&a.hasClass("medium-insert-images")&&m.push(a.find("img")),(l=f.selection.getSelectionHtml(h))&&u("<div></div>").html(l).find(".medium-insert-images img").each(function(){m.push(u(this))})),m.length)){for(d=0;d<m.length;d++)this.deleteFile(m[d].attr("src"),m[d]),t=m[d].closest(".medium-insert-images"),m[d].closest("figure").remove(),0===t.find("figure").length&&(!1!==(i=t.next()).is("p")&&""===i.text()||(i=u(this.templates["src/js/templates/core-empty-line.hbs"]().trim()),t.before(i)),t.remove());this.core.hideAddons(),!l&&i&&(e.preventDefault(),this.core.moveCaret(i)),u(".medium-insert-images-toolbar, .medium-insert-images-toolbar2").remove(),this.core.triggerInput()}},s.prototype.deleteFile=function(e,t){this.options.deleteScript&&("function"==typeof this.options.deleteScript?this.options.deleteScript(e,t):u.ajax(u.extend(!0,{},{url:this.options.deleteScript,type:this.options.deleteMethod||"POST",data:{file:e}},this.options.fileDeleteOptions)))},s.prototype.addToolbar=function(){if(this.options.toolbar){var e,t,i=this.$el.find(".medium-insert-image-active").closest(".medium-insert-images"),o=!1,s=this.core.getEditor().options.elementsContainer||"body";u(s).append(this.templates["src/js/templates/images-toolbar.hbs"]({styles:this.options.styles,actions:this.options.actions}).trim()),e=u(".medium-insert-images-toolbar"),t=u(".medium-insert-images-toolbar2"),e.find("button").each(function(){i.hasClass("medium-insert-images-"+u(this).data("action"))&&(u(this).addClass("medium-editor-button-active"),o=!0)}),!1===o&&e.find("button").first().addClass("medium-editor-button-active"),this.repositionToolbars(),e.fadeIn(),t.fadeIn()}},s.prototype.autoRepositionToolbars=function(){setTimeout(function(){this.repositionToolbars(),this.repositionToolbars()}.bind(this),0)},s.prototype.repositionToolbars=function(){var e=u(".medium-insert-images-toolbar"),t=u(".medium-insert-images-toolbar2"),i=this.$el.find(".medium-insert-image-active"),o=this.core.getEditor().options.elementsContainer,s=-1<["absolute","fixed"].indexOf(p.getComputedStyle(o).getPropertyValue("position")),n=s?o.getBoundingClientRect():null,r=u(p).width(),a={};t.length&&(a.top=i.offset().top+2,a.left=i.offset().left+i.width()-t.width()-4,s&&(a.top+=o.scrollTop-n.top,a.left-=n.left,r=u(o).width()),a.left+t.width()>r&&(a.left=r-t.width()),t.css(a)),e.length&&(i.closest(".medium-insert-images-grid-active").length&&(i=i.closest(".medium-insert-images-grid-active")),a.top=i.offset().top-e.height()-8-2-5,a.left=i.offset().left+i.width()/2-e.width()/2,s&&(a.top+=o.scrollTop-n.top,a.left-=n.left),a.top<0&&(a.top=0),e.css(a))},s.prototype.toolbarAction=function(e){var t,i,o,s,n=this;null!==this.$currentImage&&(o=(i=(t=u(e.target).is("button")?u(e.target):u(e.target).closest("button")).closest("li")).closest("ul").find("li"),s=this.$el.find(".medium-insert-active"),t.addClass("medium-editor-button-active"),i.siblings().find(".medium-editor-button-active").removeClass("medium-editor-button-active"),o.find("button").each(function(){var e="medium-insert-images-"+u(this).data("action");u(this).hasClass("medium-editor-button-active")?(s.addClass(e),n.options.styles[u(this).data("action")].added&&n.options.styles[u(this).data("action")].added(s)):(s.removeClass(e),n.options.styles[u(this).data("action")].removed&&n.options.styles[u(this).data("action")].removed(s))}),this.core.hideButtons(),this.core.triggerInput())},s.prototype.toolbar2Action=function(e){var t,i;null!==this.$currentImage&&(t=u(e.target).is("button")?u(e.target):u(e.target).closest("button"),(i=this.options.actions[t.data("action")].clicked)&&i(this.$el.find(".medium-insert-image-active")),this.core.hideButtons(),this.core.triggerInput())},s.prototype.sorting=function(){u.proxy(this.options.sorting,this)()},u.fn[i+t]=function(e){return this.each(function(){u.data(this,"plugin_"+i+t)||u.data(this,"plugin_"+i+t,new s(this,e))})}}(jQuery,window,document,f.util)});